# config/settings.py
"""
项目配置文件
复制此文件为 settings.py 并填入你的配置
"""
import os
from pathlib import Path

# 项目根目录
BASE_DIR = Path(__file__).parent.parent

# 数据目录
DATA_DIR = BASE_DIR / "data"
DATA_DIR.mkdir(exist_ok=True)

# ============= Tushare 配置 =============
# 请从 https://tushare.pro 注册并获取你的 token
TUSHARE_TOKEN = os.getenv("TUSHARE_TOKEN", "your_tushare_token_here")
TUSHARE_DB_PATH = DATA_DIR / "tushare_data.db"

# ============= AKShare 配置 =============
AKSHARE_DB_PATH = DATA_DIR / "akshare_data.db"

# ============= 数据源配置 =============
# 复权类型：''=不复权（实盘价格）, 'qfq'=前复权（计算收益）, 'hfq'=后复权
# 说明：
# - 不复权（''）：获取的是实盘实际价格，适合查看和实盘对比
# - 前复权（'qfq'）：历史价格被调整，适合计算收益率
# - 后复权（'hfq'）：当前价格被调整，较少使用
DEFAULT_ADJUST = ""  # 默认使用不复权，获取实盘实际价格

# ============= 数据库配置 =============
DEFAULT_DB_PATH = DATA_DIR / "stock_data.db"

# ============= 股票配置 =============
# 要下载的股票列表
A_STOCKS = ["600382", "600711", "000001", "600519"]
HK_STOCKS = ["01810"]

# 用于验证的股票代码
DEFAULT_STOCK = "600382"

# ============= 回测配置 =============
DEFAULT_INITIAL_CASH = 1000000  # 初始资金
DEFAULT_COMMISSION = 0.002       # 手续费 0.2%
DEFAULT_BACKTEST_START = "2025-07-01"  # 默认回测开始日期

# ============= 日期配置 =============
DEFAULT_START_DATE = "20200101"
# DEFAULT_END_DATE 不再设置固定值，默认使用当前日期
# 如果系统时间不准确，请在调用时手动指定 end_date 参数

# ============= API 配置 =============
REQUEST_TIMEOUT = 30  # 请求超时时间（秒）
MAX_RETRIES = 3       # 最大重试次数

# ============= Tushare API 调用配置 =============
API_RATE_LIMIT_DELAY = 1.3  # 每次API调用的最小间隔（秒），50次/分钟
API_MAX_RETRIES = 3         # API调用失败时的最大重试次数

# ============= 数据下载配置 =============
DOWNLOAD_START_DATE = "20240101"  # 默认下载起始日期（最近2年）
PROGRESS_INTERVAL = 50            # 每处理N只股票显示一次进度
CHECKPOINT_FILE = DATA_DIR / "download_checkpoint.json"  # 断点续传文件

# ============= Claude Code CLI 配置 =============
# 使用Claude CLI进行自然语言处理，无需API密钥
CLAUDE_TIMEOUT = int(os.getenv("API_TIMEOUT_MS", "60000")) // 1000  # CLI超时时间（秒）
CLAUDE_CLI_PATH = os.getenv("CLAUDE_CLI_PATH", "")  # 可选：指定Claude CLI路径

# ============= 定时任务配置 =============
SCHEDULE_DB_PATH = DATA_DIR / "schedule.db"
SCHEDULER_TIMEZONE = 'Asia/Shanghai'
MAX_CONCURRENT_TASKS = 3
TASK_CLEANUP_AGE_HOURS = 168  # 7天
CHECKPOINT_DIR = DATA_DIR / "checkpoints"
CHECKPOINT_DIR.mkdir(exist_ok=True)

# ============= 任务数据库配置 =============
TASKS_DB_PATH = DATA_DIR / "tasks.db"
